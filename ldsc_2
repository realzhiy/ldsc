# mapping the gene set to ldsc score###########################for i in *.txt;dobasefile_name=$(basename $i .txt)./ldsc.py \--h2 /rds/general/user/zw4419/home/LDSC/SumStats/fat-distn.giant.ukbb.meta-analysis.whr.combined.sumstats.gz \--w-ld-chr /rds/general/user/zw4419/home/LDSC/REF/weights_hm3_no_hla/weights. \--ref-ld-chr /rds/general/user/zw4419/home/LDSC/Annot_ALL/$basefile_name.,/rds/general/user/zw4419/home/LDSC/REF/1000G_EUR_Phase3_baselineNEW/baseline. \--overlap-annot \--frqfile-chr /rds/general/user/zw4419/home/LDSC/REF/1000G_Phase3_frq/1000G.EUR.QC. \--out $basefile_name \--print-coefficientsmv $basefile_name.results /rds/general/user/zw4419/home/LDSC/LDSC_Results_FATSLdone##end of bash sessionlibrary(data.table)library(ggplot2)library(cowplot)setwd("/Users/zhiy/Desktop/Applied_Genomics/BMEC/brain_ldsc/LDSC_Results/Astro_up")FOLDERS=list.files()count=0for(FOLD in FOLDERS){All.files=list.files(path=FOLD,pattern="")for(file in All.files){data=fread(sprintf("%s/%s",FOLD,file))tmp=data[1,]tmp$FOLD=FOLDtmp$file=fileif(count==0){Results.Table=tmp}else{Results.Table=rbind(Results.Table,tmp)}count=count+1}}Results.Table$ct=gsub("_\\w[^_]*.results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(".results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(paste(FOLDERS,collapse="|"),"",Results.Table$ct)Results.Table$ct=gsub("_$","",Results.Table$ct)pdf("Enrichment_adjusted.pdf")ggplot(Results.Table) +	geom_bar(aes(x = ct, y = log10(p.adjust(Enrichment_p,method="BH")), fill = FOLD), stat = "identity", position = "dodge") +	scale_y_continuous(trans = "reverse", breaks = log10(c(0.001, 0.01, 0.1, 1))) +	coord_flip() +	theme_cowplot() +	geom_hline(yintercept = (log10(0.05))[1]) +	theme(axis.text.y = element_text(size = 8), axis.text.x = element_text(size = 8))dev.off()################################################################################################################################################################################################setwd("/Users/zhiy/Desktop/Applied_Genomics/BMEC/brain_ldsc/LDSC_Results/Astro_down")Results.Table=dataframe()FOLDERS=list.files()count=0for(FOLD in FOLDERS){All.files=list.files(path=FOLD,pattern=".results")for(file in All.files){data=fread(sprintf("%s/%s",FOLD,file))tmp=data[1,]tmp$FOLD=FOLDtmp$file=fileif(count==0){Results.Table=tmp}else{Results.Table=rbind(Results.Table,tmp)}count=count+1}}Results.Table$ct=gsub("_\\w[^_]*.results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(".results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(paste(FOLDERS,collapse="|"),"",Results.Table$ct)Results.Table$ct=gsub("_$","",Results.Table$ct)setwd("/Users/zhiy/Desktop/Applied_Genomics/BMEC/brain_ldsc/LDSC_Results/Per_up")FOLDERS=list.files()count=0for(FOLD in FOLDERS){All.files=list.files(path=FOLD,pattern="")for(file in All.files){data=fread(sprintf("%s/%s",FOLD,file))tmp=data[1,]tmp$FOLD=FOLDtmp$file=fileif(count==0){Results.Table=tmp}else{Results.Table=rbind(Results.Table,tmp)}count=count+1}}Results.Table$ct=gsub("_\\w[^_]*.results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(".results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(paste(FOLDERS,collapse="|"),"",Results.Table$ct)Results.Table$ct=gsub("_$","",Results.Table$ct)pdf("Enrichment.pdf")ggplot(Results.Table) +	geom_bar(aes(x = ct, y = log10(Enrichment_p), fill = FOLD), stat = "identity", position = "dodge") +	scale_y_continuous(trans = "reverse", breaks = log10(c(0.001, 0.01, 0.1, 1))) +	coord_flip() +	theme_cowplot() +	geom_hline(yintercept = (log10(0.05))[1]) +	theme(axis.text.y = element_text(size = 8), axis.text.x = element_text(size = 8))dev.off()ggplot(Results.Table) +	geom_bar(aes(x = ct, y = log10(Enrichment_p), fill = FOLD), stat = "identity", position = "dodge") +	scale_y_continuous(trans = "reverse", breaks = log10(c(0.001, 0.01, 0.1, 1))) +	coord_flip() +	theme_cowplot() +	geom_hline(yintercept=(log10(0.05))[1])ggplot(Results.Table) + geom_bar(aes(x=ct,y=Enrichment_p,fill=FOLD),stat="identity",position="dodge") + scale_y_log10() + coord_flip() + theme_cowplot() + geom_hline(yintercept=0.05/dim(Results.Table)[1])setwd("/Users/zhiy/Desktop/Applied_Genomics/BMEC/brain_ldsc/LDSC_Results")FOLDERS=list.files()count=0Results.Table <- data.frame()for(FOLD in FOLDERS){#	All.files=list.files(path=FOLD,pattern=".results")	All.files=list.files()	for(file in All.files){		data=fread(sprintf("%s/%s",FOLD,file))		tmp=data[1,]		tmp$FOLD=FOLD		tmp$file=file		if(count==0){			Results.Table=tmp		}else{			Results.Table=rbind(Results.Table,tmp)		}		count=count+1	}}Results.Table$ct=gsub("_\\w[^_]*.results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(".results","",Results.Table$file,perl=TRUE)Results.Table$ct=gsub(paste(FOLDERS,collapse="|"),"",Results.Table$ct)Results.Table$ct=gsub("_$","",Results.Table$ct)ggplot(Results.Table) + geom_bar(aes(x=ct,y=Enrichment_p,fill=FOLD),stat="identity",position="dodge") + scale_y_log10() + coord_flip() + theme_cowplot() + geom_hline(yintercept=0.05/dim(Results.Table)[1])# use -log10for file in Per_down.ENTID.*.sumstats.gz.results; do    newname=$(echo "$file" | sed 's/Per_down\.ENTID\.//; s/\.sumstats\.gz\.results//')    mv "$file" "$newname"done